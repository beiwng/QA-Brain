# 🚀 知识库功能快速开始指南

## 📋 前置条件

1. ✅ 后端服务正常运行（FastAPI）
2. ✅ 前端服务正常运行（React）
3. ✅ MySQL 数据库已连接
4. ✅ Milvus 向量数据库已连接
5. ✅ LLM API 已配置

---

## 🔧 安装依赖

### 1. 安装 Python 依赖

```bash
cd backend
pip install pandas openpyxl python-multipart
```

或使用 requirements.txt：

```bash
pip install -r backend/requirements.txt
```

### 2. 创建数据库表

```bash
# 运行迁移脚本
python -m backend.scripts.create_bug_records_table
```

---

## 📝 使用步骤

### 步骤 1: 启动服务

```bash
# 启动后端
cd backend
python -m uvicorn backend.main:app --reload --port 8000

# 启动前端（新终端）
cd frontend
npm run dev
```

### 步骤 2: 访问知识库管理页面

1. 打开浏览器访问：`http://localhost:5173`
2. 点击左侧菜单"知识库管理"
3. 看到两个 Tab：
   - **缺陷库管理**：管理历史缺陷
   - **知识库概览**：查看统计数据

---

## 📊 功能演示

### 功能 1: Excel 批量导入

#### 1.1 下载模板

1. 在"缺陷库管理" Tab 中
2. 点击"下载模板"按钮
3. 获得一个包含示例数据的 Excel 文件

#### 1.2 填写数据

打开 Excel 文件，填写缺陷数据：

| 标题 | 描述 | 根因 | 解决方案 | 严重程度 | 分类 | 影响版本 | 报告人 |
|------|------|------|----------|----------|------|----------|--------|
| 登录失败 | 用户无法登录系统 | 密码加密算法错误 | 修复加密算法 | Critical | 功能 | v1.0.0 | 张三 |
| 页面加载慢 | 首页加载超过 5 秒 | 数据库查询未优化 | 添加索引 | Major | 性能 | v1.1.0 | 李四 |

**支持的列名**（可以使用任意一种）：
- 标题 / 摘要 / 缺陷标题 → summary
- 描述 / 详细描述 / 复现步骤 → description
- 原因 / 根因 / 问题原因 → root_cause
- 解决方案 / 处理结果 / 修复方案 → solution
- 严重程度 / 优先级 → severity
- 分类 / 缺陷分类 / 类型 → category
- 影响版本 / 版本 → affected_version
- 报告人 / 提交人 → reporter

#### 1.3 上传 Excel

1. 点击"Excel 导入"按钮
2. 选择填写好的 Excel 文件
3. 等待上传完成
4. 看到成功提示："成功导入 N 条数据，后台正在建立索引，请稍候..."

#### 1.4 查看结果

- 表格中会显示导入的缺陷记录
- 如果有失败的记录，会弹出详细错误信息

---

### 功能 2: 手动录入缺陷

#### 2.1 打开表单

1. 在"缺陷库管理" Tab 中
2. 点击"手动录入"按钮
3. 弹出表单对话框

#### 2.2 填写表单

**必填字段**：
- 缺陷标题

**可选字段**：
- 详细描述/复现步骤
- 问题原因（建议填写，关键知识）
- 解决方案（建议填写，关键知识）
- 影响范围
- 严重程度（Critical/Major/Minor/Trivial）
- 缺陷分类（功能/性能/UI/数据）
- 影响版本
- 报告人
- 经办人
- 状态（Open/In Progress/Closed）

#### 2.3 提交

1. 点击"确定"按钮
2. 等待保存完成
3. 表格中会显示新增的记录
4. 后台自动建立向量索引

---

### 功能 3: 查看知识库统计

#### 3.1 切换到概览 Tab

1. 点击"知识库概览" Tab
2. 看到统计卡片和图表

#### 3.2 统计卡片

- **历史缺陷总数**：从 Excel 导入或手动录入的 Bug 数量
- **已索引决策数**：在决策回溯模块创建的决策数量
- **知识库总量**：缺陷 + 决策的总数
- **系统智商指数**：根据知识库数量计算（最高 100）

#### 3.3 分布图表

- **缺陷严重程度分布**：Critical / Major / Minor / Trivial
- **缺陷分类分布**：功能 / 性能 / UI / 数据
- **各版本缺陷数量分布**：Top 10 版本

---

### 功能 4: 自动化决策入库

#### 4.1 创建决策

1. 访问"决策回溯"页面
2. 点击"新增决策"按钮
3. 填写决策信息：
   - 标题
   - 背景
   - 结论
   - 负责人
   - 状态

#### 4.2 自动向量化

- 决策保存后，系统会自动：
  1. 保存到 MySQL 数据库
  2. 后台任务：构建向量化文本
  3. 调用 Embedding API
  4. 插入 Milvus 向量数据库

- **无需手动操作**，完全自动化！

#### 4.3 验证

1. 访问"知识库概览"页面
2. 查看"已索引决策数"是否增加
3. 在"智能分析"页面提问，系统会检索到新决策

---

### 功能 5: 智能分析（RAG 检索）

#### 5.1 提问

1. 访问"智能分析"页面
2. 输入问题，例如：
   - "登录失败怎么办？"
   - "页面加载慢如何优化？"
   - "数据库连接超时的原因？"

#### 5.2 系统检索

系统会同时检索：
1. **历史决策**（高优先级）
2. **历史缺陷**（参考）

#### 5.3 查看结果

- 系统会引用相关决策和缺陷
- 重点关注历史缺陷的"根因"和"解决方案"
- 如果没有相关信息，会给出通用建议

---

## 🎯 最佳实践

### 1. Excel 导入

✅ **推荐做法**：
- 使用官方模板，避免列名错误
- 尽量填写"根因"和"解决方案"字段（关键知识）
- 批量导入多条记录，提高效率
- 导入后检查错误信息

❌ **避免**：
- 不要使用不支持的列名
- 不要留空"标题"字段（必填）
- 不要上传非 Excel 格式文件

### 2. 手动录入

✅ **推荐做法**：
- 填写详细的描述和复现步骤
- 重点填写"问题原因"和"解决方案"
- 选择正确的严重程度和分类
- 填写影响版本，便于统计

❌ **避免**：
- 不要只填标题，缺少详细信息
- 不要忽略根因和解决方案（关键知识）

### 3. 决策记录

✅ **推荐做法**：
- 遇到重要决策立即记录
- 背景和结论要详细
- 及时更新决策状态
- 系统会自动向量化，无需手动操作

❌ **避免**：
- 不要延迟记录，容易遗忘
- 不要描述过于简单

### 4. 智能分析

✅ **推荐做法**：
- 提供足够的上下文信息
- 参考系统引用的历史决策和缺陷
- 持续积累知识库，提高准确性

❌ **避免**：
- 不要提问过于简单或模糊
- 不要忽略系统的建议

---

## 🐛 常见问题

### Q1: Excel 导入失败？

**检查清单**：
- [ ] 文件格式是否为 .xlsx 或 .xls
- [ ] 是否包含"标题"列（必填）
- [ ] 列名是否使用支持的中文表头
- [ ] 查看错误信息详情

**解决方法**：
1. 下载官方模板
2. 复制数据到模板中
3. 重新上传

### Q2: 向量化失败？

**检查清单**：
- [ ] Milvus 服务是否正常运行
- [ ] Embedding API 是否可访问
- [ ] 查看后端日志

**解决方法**：
```bash
# 检查 Milvus 状态
docker ps | grep milvus

# 查看后端日志
tail -f backend/logs/app.log
```

### Q3: 智能分析找不到相关知识？

**可能原因**：
1. 知识库数据量不足
2. 问题描述不够详细
3. 向量化尚未完成（后台任务）

**解决方法**：
1. 导入更多历史缺陷
2. 记录更多决策
3. 等待几秒钟，让后台任务完成
4. 提供更详细的问题描述

### Q4: 如何提高系统智商指数？

**方法**：
1. 导入更多历史缺陷（Excel 批量导入）
2. 记录更多决策（决策回溯模块）
3. 填写完整的根因和解决方案
4. 持续积累，系统会越来越智能

---

## 📚 相关文档

- **实现文档**：`docs/KNOWLEDGE_BASE_IMPLEMENTATION.md`
- **API 文档**：`docs/API.md`
- **更新日志**：`CHANGELOG.md`

---

## 🎉 总结

现在您已经掌握了知识库功能的使用方法！

**核心功能**：
1. ✅ Excel 批量导入历史缺陷
2. ✅ 手动录入缺陷记录
3. ✅ 查看知识库统计和分布
4. ✅ 自动化决策入库
5. ✅ 智能分析（RAG 检索）

**下一步**：
1. 导入您的历史缺陷数据
2. 记录重要决策
3. 使用智能分析功能
4. 持续积累知识库

**系统会越用越智能！** 🚀

