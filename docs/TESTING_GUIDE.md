# 🧪 QA-Brain 测试指南

## 📋 测试清单

### 1. 智能分析 - 历史记录持久化测试

#### 测试步骤：

1. **访问智能分析页面**
   ```
   http://localhost:1314/analysis
   ```

2. **进行第一次分析**
   - 在左侧输入框输入：`用户登录时出现 500 错误`
   - 点击"开始分析"按钮
   - 等待分析完成
   - 观察左侧"分析历史"是否出现新记录

3. **进行更多分析**（重复 2-3 次）
   - 输入不同的 Bug 描述
   - 每次分析后检查历史记录是否增加

4. **测试持久化**
   - 刷新页面（F5）
   - 检查历史记录是否仍然存在 ✅
   - 切换到其他页面（如"仪表盘"）
   - 再切换回"智能分析"页面
   - 检查历史记录是否仍然存在 ✅

5. **测试最大数量限制**
   - 连续进行 6 次以上的分析
   - 检查历史记录是否只保留最近 5 条 ✅

6. **测试点击历史记录**
   - 点击任意历史记录
   - 检查右侧是否显示对应的分析结果 ✅
   - 检查左侧输入框是否自动填充对应的查询 ✅

#### 预期结果：

- ✅ 历史记录自动保存
- ✅ 刷新页面后历史记录仍然存在
- ✅ 切换页面后历史记录仍然存在
- ✅ 最多保留 5 条记录
- ✅ 点击历史记录可查看详情

---

### 2. 智能分析 - 进度显示测试

#### 测试步骤：

1. **访问智能分析页面**
   ```
   http://localhost:1314/analysis
   ```

2. **开始分析**
   - 输入任意 Bug 描述
   - 点击"开始分析"按钮
   - **立即观察右侧区域**

3. **观察进度步骤**
   - 检查是否显示 3 个步骤：
     1. 检索相关决策 🔍
     2. 评估相关性 ✅
     3. 生成分析报告 🤖
   - 观察当前步骤是否有旋转加载图标
   - 观察已完成步骤是否显示绿色对勾

4. **检查步骤描述**
   - 步骤 1：从知识库中搜索相似的历史决策...
   - 步骤 2：分析检索结果的相关性和可信度...
   - 步骤 3：调用 AI 模型生成专业的 Bug 分析...

5. **等待完成**
   - 分析完成后，检查是否显示分析结果
   - 检查进度步骤是否消失

#### 预期结果：

- ✅ 显示 3 个步骤的进度条
- ✅ 当前步骤显示蓝色 + 旋转图标
- ✅ 已完成步骤显示绿色 + 对勾
- ✅ 未开始步骤显示灰色图标
- ✅ 每个步骤有清晰的描述
- ✅ 分析完成后显示结果

---

### 3. 决策回溯 - 布局滚动测试

#### 测试步骤：

1. **访问决策回溯页面**
   ```
   http://localhost:1314/decisions
   ```

2. **测试垂直滚动**
   - 如果数据较少，先创建多条决策记录（10+ 条）
   - 向下滚动页面
   - 观察左侧导航栏是否固定不动 ✅
   - 观察表格列是否对齐 ✅

3. **测试横向滚动**
   - 缩小浏览器窗口宽度
   - 观察是否出现横向滚动条
   - 滚动时检查列是否错位

4. **测试窗口缩放**
   - 放大/缩小浏览器窗口
   - 检查布局是否自适应
   - 检查是否出现多个滚动条

#### 预期结果：

- ✅ 左侧导航栏固定不动
- ✅ 表格列始终对齐
- ✅ 只有一个垂直滚动条（在内容区域）
- ✅ 横向滚动正常（如果表格超宽）
- ✅ 窗口缩放时布局正常

---

### 4. 数据可视化 - 图表显示测试

#### 测试步骤：

1. **访问数据可视化页面**
   ```
   http://localhost:1314/visualization
   ```

2. **检查统计卡片**
   - 总决策数
   - 活跃决策
   - 已废弃决策
   - AI 分析次数

3. **检查图表**
   - 30天趋势分析折线图
   - 决策人分布柱状图
   - Bug 严重程度饼图
   - 最近 7 天决策柱状图

4. **测试自动刷新**
   - 等待 30 秒
   - 观察数据是否自动刷新

#### 预期结果：

- ✅ 所有统计卡片显示正确
- ✅ 所有图表正常渲染
- ✅ 图表有动画效果
- ✅ 30 秒后自动刷新

---

### 5. 决策版本控制测试

#### 测试步骤：

1. **访问决策回溯页面**
   ```
   http://localhost:1314/decisions
   ```

2. **编辑决策**
   - 点击任意决策的"编辑"按钮
   - 修改标题、背景或结论
   - 填写"修改原因"和"修改人"
   - 点击"提交"

3. **查看版本历史**
   - 点击同一决策的"历史"按钮
   - 检查是否显示版本历史时间轴
   - 检查版本号是否递增
   - 检查修改原因是否显示

4. **多次编辑**
   - 再次编辑同一决策
   - 查看版本历史
   - 检查是否有多个版本

#### 预期结果：

- ✅ 编辑成功并显示成功消息
- ✅ 版本历史显示所有版本
- ✅ 版本号自动递增
- ✅ 修改原因正确显示
- ✅ 时间轴展示清晰

---

## 🔍 浏览器兼容性测试

### 推荐测试的浏览器：

1. **Chrome** (推荐)
   - 版本：最新版
   - localStorage 支持：✅
   - 滚动条宽度：约 17px

2. **Firefox**
   - 版本：最新版
   - localStorage 支持：✅
   - 滚动条宽度：约 17px

3. **Edge**
   - 版本：最新版
   - localStorage 支持：✅
   - 滚动条宽度：约 17px

4. **Safari** (Mac)
   - 版本：最新版
   - localStorage 支持：✅
   - 滚动条宽度：约 15px

### 测试要点：

- [ ] 历史记录在所有浏览器中正常保存
- [ ] 布局在所有浏览器中正常显示
- [ ] 滚动条不会导致错位
- [ ] 图表在所有浏览器中正常渲染

---

## 🐛 常见问题排查

### 问题 1: 历史记录不保存

**可能原因**：
- 浏览器隐私模式
- localStorage 被禁用
- 浏览器缓存已满

**解决方案**：
1. 退出隐私模式
2. 检查浏览器设置，启用 localStorage
3. 清除浏览器缓存
4. 打开浏览器控制台，检查是否有错误

**验证方法**：
```javascript
// 在浏览器控制台运行
localStorage.setItem('test', 'value')
console.log(localStorage.getItem('test')) // 应该输出 'value'
```

---

### 问题 2: 进度步骤不显示

**可能原因**：
- 网络请求太快，步骤一闪而过
- 前端代码错误

**解决方案**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 观察 API 请求时间
4. 检查 Console 是否有错误

---

### 问题 3: 布局仍然错位

**可能原因**：
- 浏览器缓存未清除
- CSS 未正确加载

**解决方案**：
1. 强制刷新页面（Ctrl + Shift + R）
2. 清除浏览器缓存
3. 检查浏览器控制台是否有 CSS 加载错误

---

### 问题 4: 图表不显示

**可能原因**：
- 数据为空
- @ant-design/charts 未安装

**解决方案**：
1. 检查是否有数据：访问 http://localhost:8000/api/statistics
2. 重新安装依赖：
   ```bash
   cd frontend
   npm install
   ```

---

## 📊 性能测试

### 1. 历史记录加载速度

**测试方法**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Performance 标签
3. 刷新页面
4. 观察 localStorage 读取时间

**预期结果**：
- 加载时间 < 10ms

---

### 2. 分析响应时间

**测试方法**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 进行一次分析
4. 观察 `/api/analyze` 请求时间

**预期结果**：
- 响应时间 < 10 秒（取决于 LLM 速度）

---

### 3. 页面滚动性能

**测试方法**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Performance 标签
3. 开始录制
4. 快速滚动页面
5. 停止录制
6. 观察 FPS（帧率）

**预期结果**：
- FPS > 50（流畅滚动）

---

## ✅ 完整测试检查表

### 功能测试

- [ ] 智能分析 - 历史记录保存
- [ ] 智能分析 - 历史记录加载
- [ ] 智能分析 - 历史记录点击
- [ ] 智能分析 - 进度显示
- [ ] 智能分析 - 分析结果展示
- [ ] 决策回溯 - 列表显示
- [ ] 决策回溯 - 搜索过滤
- [ ] 决策回溯 - 创建决策
- [ ] 决策回溯 - 编辑决策
- [ ] 决策回溯 - 版本历史
- [ ] 数据可视化 - 统计卡片
- [ ] 数据可视化 - 图表展示
- [ ] 数据可视化 - 自动刷新

### 布局测试

- [ ] 左侧导航栏固定
- [ ] 表格列对齐
- [ ] 垂直滚动正常
- [ ] 横向滚动正常（如需要）
- [ ] 窗口缩放自适应
- [ ] 移动端响应式（可选）

### 浏览器兼容性

- [ ] Chrome 测试通过
- [ ] Firefox 测试通过
- [ ] Edge 测试通过
- [ ] Safari 测试通过（Mac）

### 性能测试

- [ ] 历史记录加载 < 10ms
- [ ] 分析响应 < 10s
- [ ] 页面滚动 FPS > 50

---

## 📝 测试报告模板

```markdown
# QA-Brain 测试报告

**测试日期**: 2025-11-20
**测试人员**: [您的名字]
**测试版本**: v1.1.2
**测试浏览器**: Chrome 120.0.0.0

## 测试结果

### 功能测试
- ✅ 智能分析 - 历史记录持久化
- ✅ 智能分析 - 进度显示
- ✅ 决策回溯 - 版本控制
- ✅ 数据可视化 - 图表展示

### 布局测试
- ✅ 滚动条不会导致错位
- ✅ 表格列对齐正常

### 性能测试
- ✅ 历史记录加载: 5ms
- ✅ 分析响应时间: 8s
- ✅ 页面滚动 FPS: 60

## 发现的问题
无

## 建议
无

## 总结
所有功能测试通过，系统运行正常。
```

---

**测试指南版本**: v1.0  
**最后更新**: 2025-11-20

